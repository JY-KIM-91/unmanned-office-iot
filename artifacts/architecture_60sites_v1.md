# 60개 지점 무인 운영 서비스 아키텍처

**목적**: 서울·수도권 60개 공유 오피스 지점의 표준화된 무인 운영 시스템 설계
**작성일**: 2026-02-16

---

## 1. 아키텍처 구성요소

### 1.1 Device Layer (디바이스 계층)

**책임**: 물리적 센싱 및 제어

**구성요소**:
- 출입통제: BLE/RFID 리더, 전기 도어락, 모터라이즈 게이트
- 감시: IP 카메라 (ONVIF 지원), PIR 센서, 환경 센서 (온도/습도/CO2)
- 설비제어: 조명 컨트롤러 (DALI/KNX), HVAC 컨트롤러, 전력 모니터링 (RS485/Modbus)
- 사용자 인터페이스: 터치 키오스크, QR 스캐너, 인터폰

**요구조건**:
- IEC/UL 인증급 산업용 디바이스
- MQTT/HTTP 기반 양방향 통신 지원
- 로컬 큐잉 및 재연결 로직 내장
- 보안 펌웨어 업데이트 (OTA) 지원

---

### 1.2 Edge Layer (지점 게이트웨이)

**책임**: 지점 내 로컬 제어 및 오프라인 운영 보장

**핵심 기능**:
- 권한 캐시: 활성 회원 출입 권한 (4시간 TTL, Cloud 동기화)
- 이벤트 버퍼: 네트워크 단절 시 최대 48시간 로그 저장 (SSD 기반)
- 로컬 결정: 출입/예약 검증을 Edge에서 실시간 처리 (<100ms)
- Device 관리: 지점 내 모든 IoT 디바이스 헬스체크 및 펌웨어 배포

**Fail-safe 정책**:
- 네트워크 단절 시: 캐시된 권한으로 출입 허용 (화이트리스트 모드)
- 화재/재난 신호: 모든 도어 자동 언락 (Fail-safe unlock)
- 보안 모드: 야간/비상 시 승인된 인증만 허용 (Fail-secure)

**기술 스택**:
- 산업용 엣지 게이트웨이 (Linux 기반, Docker 지원, 4G/5G 백업)
- 로컬 DB: SQLite (권한 캐시), Redis (이벤트 큐)
- 프로토콜: MQTT (디바이스 통신), gRPC (Cloud 동기화)

---

### 1.3 Cloud Layer (중앙 클라우드)

**책임**: 전 지점 통합 관리, 데이터 분석, 정책 배포

**핵심 모듈**:

#### Access Module (출입통제)
- 회원 권한 관리 (RBAC: 시간대/지점/구역별)
- 타지점 이용 권한 자동 검증
- 실시간 출입 로그 수집 및 감사 추적

#### Booking Module (예약 관리)
- 회의실/폰부스/리차징존 예약 엔진
- 실시간 사용 중 감지 (센서 연동)
- 노쇼 자동 취소 (15분 유예)

#### Billing Module (정산)
- 사용량 기반 과금 (회의실/F&B/프린트)
- 선불/후불 정책 엔진
- 결제 게이트웨이 통합 (PG사 연동)

#### Monitoring Module (중앙관제)
- 60개 지점 실시간 대시보드
- 이상 징후 탐지 (장기 미퇴실, 무단 출입, 설비 고장)
- 알림 라우팅 (지점 담당자/본사/외주 업체)

#### Policy Module (정책 관리)
- 지점별 운영 정책 (영업시간, 출입규칙, 자동화 시나리오)
- A/B 테스트 지원 (일부 지점 선택 적용)
- 정책 버전 관리 및 롤백

#### Data Module (데이터 플랫폼)
- 이벤트 스트림 처리 (Kafka/Pulsar 요구)
- 시계열 데이터 저장 (메트릭, 에너지, 점유율)
- 분석 엔진 (사용 패턴, 예측 유지보수, 수익 최적화)

**기술 요구사항**:
- 멀티 테넌트 아키텍처 (향후 B2B 확장 대비)
- Auto-scaling (지점 추가 시 선형 확장)
- 99.9% SLA (월 43분 다운타임 허용)
- GDPR/개인정보보호법 준수 (로그 암호화, 90일 자동 삭제)

---

### 1.4 Console Layer (관리 콘솔)

**책임**: 운영자 인터페이스

**사용자 역할**:
- 본사 관제팀: 전 지점 모니터링, 정책 배포
- 지점 매니저: 해당 지점 출입/예약/설비 관리
- 외주 업체: 제한된 뷰 (설비 고장 알림만)

**주요 기능**:
- 실시간 지점 맵 (출입/점유/알림 오버레이)
- 원격 도어 제어 (긴급 상황 대응)
- 리포트 생성 (일/주/월 운영 현황, CSV/PDF)
- 감사 로그 조회 (누가/언제/무엇을 변경)

---

## 2. 지점 단위 확장 전략

### 2.1 계층적 모델: Tenant → Site → Zone

**Tenant (테넌트)**:
- 정의: 법적 운영 주체 (예: 패스트파이브 본사)
- 목적: 멀티 브랜드 지원 (위탁/RS/파워드바이 모델 구분)
- 격리: DB 스키마 분리, 암호화 키 별도

**Site (지점)**:
- 정의: 물리적 위치 (예: 강남점, 홍대점)
- 구성: 1개 Edge Gateway + N개 디바이스
- 독립성: 네트워크 단절 시에도 로컬 운영 가능

**Zone (구역)**:
- 정의: 지점 내 논리적 영역 (로비/회의실층/프라이빗 오피스)
- 용도: 세밀한 출입 권한 제어 (일부 구역은 멤버십 등급별 제한)

### 2.2 신규 지점 온보딩 (< 4시간)

1. Edge Gateway 설치 및 네트워크 연결
2. Cloud에서 Site 등록 (지점코드, 좌표, 정책 템플릿 선택)
3. 디바이스 자동 탐색 (MQTT discovery) 및 Zone 할당
4. 기본 권한 동기화 (전체 활성 회원 → Edge 캐시)
5. 연동 테스트 (출입/예약/알림) 후 운영 전환

### 2.3 확장성 목표

- 60 → 200개 지점: 추가 Cloud 인스턴스 없이 수평 확장
- 지점당 디바이스 수: 평균 50개, 최대 150개 지원
- 동시 이벤트 처리: 지점당 100 TPS (출입 피크타임 대비)

---

## 3. 가정 (Assumptions)

1. 지점별 인터넷 회선: 최소 100Mbps, 4G/5G 백업 가용
2. 회원 모바일 앱 보급률: 95% (BLE 출입 우선)
3. 평균 지점 규모: 1,000㎡, 동시 수용 인원 150명
4. 운영 시간: 07:00-23:00 (일부 24시간 지점)
5. 본사 관제팀: 3교대 24/7 대응 가능

---

## 4. 핵심 결정 (Decisions)

1. **Edge-first 아키텍처**: 오프라인 대응을 최우선 설계 원칙으로 채택
2. **이벤트 기반 통신**: 폴링 대신 MQTT pub/sub로 실시간성 확보
3. **권한 캐시 TTL 4시간**: 보안성(짧은 TTL)과 오프라인 운영성(긴 TTL) 절충
4. **Fail-safe 우선**: 재난 시 인명 안전을 위해 도어 자동 언락
5. **멀티 테넌트 준비**: 초기 단일 운영이지만 B2B 확장 대비 격리 구조 채택

---

## 5. 오프라인 대응 시나리오

### 시나리오 A: 지점 인터넷 단절 (2시간)
- Edge 로컬 캐시로 출입 계속 허용
- 예약 체크인은 로컬 스케줄 기반 허용
- 이벤트는 로컬 큐에 저장 → 복구 시 일괄 전송

### 시나리오 B: Cloud 장애 (30분)
- 모든 Edge는 영향 없이 운영 지속
- Console 접속 불가 (관제 일시 중단)
- 복구 시 이벤트 재동기화 (중복 제거)

### 시나리오 C: Edge Gateway 고장
- 디바이스 직접 제어 불가 → 지점 폐쇄 또는 수동 운영
- 본사 알림 발송 → 예비 게이트웨이 교체 (4시간 SLA)

---

**다음 단계**: 파일럿 1지점 상세 설계 (디바이스 사양, 네트워크 토폴로지, 비용 산정)
